<html lang="kr">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게시판</title>
  <script src="main.js"></script>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div id="contain">
    <header>
      <h1><a href="/">Test Blog</a></h1>
    </header>
    <main>
      <div id="start-menu">
        <span>전체 글 (<%=totalCount %>)</span>
        <% if (user.role === 'artemi') { %>
          <a href="/newpost" class="write-btn">✍</a>
          <a href="/logout" class="write-btn">Logout</a>
        <% } else if (user.role === 'guest') {%>
          <p class="write-btn">Hello, Guest!</p>
        <% } else if (user) {%>
          <button id="login-btn" class="write-btn">Login</button>
          <script>
            const loginBtn = document.querySelector('#login-btn');
            loginBtn.addEventListener('click', () => {
              window.location.href = '/login';
            });
          </script>
        <%}%>
      </div>
      <div id="board">
        <% var index = totalCount - 1; %>
        <% var pageNation = 10; %>
        <% for (var j = 0; j < page; j++) { %>
          <% index = index - pageNation; %>
        <% } %>
        <% if (index >= 0) { %>
          <% var i = pageNation - 1; %>
          <% if (i > index) { %>
            <% i = index; %>
          <% } %>
          <% while (i >= 0) { %>
            <div id="item">
              <a href="board/<%= data[index]._id %>">
                <h3 class="title">
                  <%= data[index].title %>
                </h3>
                <span class="body">
                  <%= data[index].body %>
                </span>
              </a>
            </div>
            <% index = index - 1 %>
            <% i = i - 1 %>
            <% } %>
        <% } %>
         <div id="page-nation">
          <% var pageNum = parseInt((totalCount - 1) / 10); %>
          <% for (var k = 0; k <= pageNum; k++) { %>
            <a href="/?page=<%=k%>"> <%= k+1 %> </a>
          <% } %>
         </div>
      </div>
    </main>
  </div>
</body>

</html>